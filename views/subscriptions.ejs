<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">

	<title><%= title %></title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
	 crossorigin="anonymous">
	<link rel="stylesheet" href="/stylesheets/navbar.css">
</head>

<%- include('./partials/header') %>

<body>
<div class="container mt-5 mb-3">
	<% if (!user) { %>
		<h2>Oops!</h2>
		<p class="h4">It appears that you are not logged in. You must <a href="/users/login">sign in</a> to an account or <a href="/users/signup">create a new one</a> before registering for subscriptions.<br><br>Once you are logged in, you may return to this page to purchase a new subscription.</p>
	<% } else if (sources.length === 0) { %> 
		<h2>Oops!</h2>
		<p class="h4">It appears that you do not yet have any payment methods saved. You must <a href="/users/payments">add a payment method</a> to your account before signing up for any subscriptions. You may return to this page to purchase a new subscription once a valid payment method has been added.</p>
	<% } else { %>
		<h2 class="mb-4"><%= product.title %> â€“ Subscriptions</h2>
		<!-- <p>Subscriptions are not currently available for <%= product.title %>s, please check back with us soon!<br>In the meantime, please feel free to browse our <a href="/catalog">catalog</a> for a listing of available products.</p> -->
		<form action="/api/cart/subscribe" method="post" id="subscription-form">
			<div class="row">
				<div class="col-md-5">
					<div class="my-3 form-group">
						<label for="card-name">Email Address</label>
						<input type="email" value="<%= user.email %>" name="email" id="email" placeholder="<%= user.email %>" class="form-control" required>
					</div>
					<div class="mt-3 form-row">
						<div class="col-6">
							<label for="sAddress">Shipping Address</label>
							<input type="address" name="sAddress" id="sAddress" placeholder="111 Street Address" class="form-control" required>
						</div>
						<div class="col-4">
							<label for="sCity">City</label>
							<input type="text" name="sCity" id="sCity" placeholder="City" class="form-control" required>
						</div>
						<div class="col-2">
							<label for="sState">State</label>
							<input type="text" name="sState" id="sState" placeholder="ST" class="form-control" required>
						</div>
					</div>	<!-- Close Shipping Address Group -->
					<div class="my-3 form-row">
						<div class="col-6">
							<label for="bAddress">Billing Address</label>
							<input type="address" name="bAddress" id="bAddress" placeholder="111 Street Address" class="form-control" required>
						</div>
						<div class="col-4">
							<label for="bCity">City</label>
							<input type="text" name="bCity" id="bCity" placeholder="City" class="form-control" required>
						</div>
						<div class="col-2">
							<label for="bState">State</label>
							<input type="text" name="bState" id="bState" placeholder="ST" class="form-control" required>
						</div>
					</div>	<!-- Close Billing Address Group -->
					<div class="">
					<p>Choose from one of your registered payment methods below<br>
					Or visit your profile page to <a href="/users/payments">add payment methods</a></p>
						<div class="row">
							<div class="col-sm-3">
								<h4>Payment Method</h4>
							</div>
							<div class="col-sm-9">
								<% sources.forEach(function(source, i) { %>
									<div class="form-check">
											<input class="form-check-input" type="radio" name="method" id="radio_<%= i %>" value="<%= source.id %>" required>
											<label class="form-check-label" for="radio_<%= i %>">
													<strong><%= source.card.brand %></strong> ending in <%= source.card.last4 %><br>
													Name on Card: <%= source.owner.name %><br>
											</label>
										</div>
								<% }) %>
							</div>
						</div>	<!-- Close Saved Payments Row -->
					</div>
				</div>	<!-- Close Payment Col -->
				<div class="col-md-5">
					<div class="row">
						<div class="col-md-6">
							<img class="img-thumbnail" src="/images/<%= product.series %>.jpg">
						</div>
						<div class="col-md-6">
							<label for="qty">Quantity per Order</label>
							<div class="input-group">
								<input class="form-control" name="qty" type="number" min="1" max="50" required>
								<div class="input-group-append">
									<span class="input-group-text" id="basic-addon2">bags</span>
								</div>
							</div>
							<label for="startDate">Start Date</label>
							<input class="form-control" name="startDate" type="date" id="startDate" required>
							<label for="freq">Frequency</label>
							<select name="freq" class="custom-select" id="freq" required>
								<option disabled selected>Frequency</option>
								<option value="1">Weekly</option>
								<option value="2">Monthly</option>
								<option value="3">Bi-Monthly</option>
								<option value="4">Quarterly</option>
								<option value="5">Semi-Annual</option>
								<option value="6">Annual</option>
							</select>
						</div>
					</div>
					<div class="row">
						<button type="submit" class="mt-5 mx-auto btn btn-primary">Proceed to Confirmation</button>
					</div>
				</div>	<!-- Close Product Col -->
			</div>
			<input name="model" value="<%= product.model %>" hidden>
		</form>
	<% } %> 
</div>
</body>

<%- include('./partials/footer') %>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
=<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

</html>