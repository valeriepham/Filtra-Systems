<!DOCTYPE html>
<html>

<head>
  <title>Profile</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <link rel="stylesheet" href="/stylesheets/navbar.css">
  <style type="text/css">
    .form-width{
      width:300px;
    }
  </style>
  <script>
    function check() {
      return confirm('Are you sure you want to delete this card?');
    }
  </script>
</head>

<%- include('../partials/header') %>
<%- include('../partials/user-navbar') %>

<body>
  <% if (message.danger) { %>
    <div class="alert alert-danger" role="alert">
      <%=message.danger%>
    </div>
  <% } %>
  <div class="container mt-5 mb-3">
    <div class="row justify-content-md-center">
      <div class="col-md-8">
        <h1 class="text-center">Saved Payment Methods</h1>
          <% sources.forEach(function(source) { %>
            <div class="card w-75 mb-3">
              <div class="card-header">                
                <h2 class="card-title"><%= source.card.brand %> Credit Card</h2>
              </div>
              <div class="card-body">
                <h5 class="card-subtitle mb-4 text-muted">Card Number: ************ <%= source.card.last4 %></h5>
                <h6>Name on Card: <%= source.owner.name %></h6>
                <h6 class="card-text">Billing Address:</h6>
                <%= source.owner.address.line1 %> <%=source.owner.address.city %>, <%= source.owner.address.state %><br><%= source.owner.address.postal_code %>, <%= source.owner.address.country %><br><br>
                <h6 class="card-text">Expiration Date:<%= source.card.exp_month %>/<%= source.card.exp_year %></h6>
                <!-- <a href="/users/payments/update/<%= source.id %>" class="card-link btn btn-primary">Update</a> -->
                <a href="/users/payments/remove/<%= source.id %>" onClick="return check()" class="card-link btn btn-danger">Remove</a>
              </div>
            </div>
          <% })%>
          <div class="card">
            <div class="card-header">
              <h2>Add New Card to Account</h2>
              <p>You may use one of the following dummy cards for testing purposes:<br>
                <em>4242424242424242</em>,    <em>5555555555554444</em>,    <em>6011111111111117</em></p>
            </div>
            <div class="card-body">
              <form action="/users/payments/add-new-card" method="post" name="new-card" id="new-card">
                <div class="form-row">
                  <label for="name">Name on Card</label>
                  <input type="text" name="name" id="name" class="form-control" required>
                </div>
                <div class=" my-2 form-row">
                  <div class="col-6">
                    <label for="address">Street Address</label>
                    <input type="text" name="address" id="address" class="form-control" required>
                  </div>
                  <div class="col-4">
                    <label for="address">City</label>
                    <input type="text" name="city" id="city" class="form-control" required>
                  </div>
                  <div class="col-2">
                    <label for="state">State</label>
                    <input type="text" name="state" id="state" class="form-control" required>
                  </div>
                </div>
                <div class="form-row my-3">
                  <label for="card-element">Credit or debit card</label>
                  <br>
                  <div style="display: block; width: 500px;" id="card-element">
                    <!-- A Stripe Element will be inserted here. -->
                  </div>
          
                  <!-- Used to display Element errors. -->
                  <div id="card-errors" role="alert"></div>
                </div>
          
                <button style="display: block; margin: 0 auto;" type="submit" class="mx-auto btn btn-primary">Add new card to account</button>
              </form>
          </div>  <!-- Close Card Body -->
        </div>  <!-- Close Card -->
      </div>  <!-- Close Center Column -->
    </div>  <!-- Close Row -->
  </div>  <!-- Close Container -->

</body>

<%- include('../partials/footer.ejs') %>

<!-- Scripts -->
<script src="https://js.stripe.com/v3/"></script>
<script src="/javascripts/new_card.js"></script>
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

</html>